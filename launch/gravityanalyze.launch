<launch>

    <!-- 
    This launch file runs the refactored visualization setup.
    It starts two separate nodes: one for visualizing the ground truth pose,
    and another for visualizing the IMU-measured gravity vector.
    -->

    <!-- Set use_sim_time for the entire ROS system -->
    <param name="use_sim_time" value="true"/>

    <!-- Arguments for the bag file paths -->
    <arg name="sensor_bag"      default="/mnt/d/Ubuntu20ROS1/Euroc_ws/MH_04_difficult.bag"/>
    <arg name="groundtruth_bag" default="/mnt/d/Ubuntu20ROS1/Euroc_ws/MH_04_difficult_true.bag"/>

    <!-- Load parameters from the config file -->
    <rosparam file="$(find imu_algorithm_visualization)/config/default.yaml" command="load" />

    <!-- Play the sensor data and ground truth bags -->
    <node pkg="rosbag" type="play" name="sensor_player" output="screen" required="true" args="--clock $(arg sensor_bag)"/>
    <node pkg="rosbag" type="play" name="groundtruth_player" output="screen" required="true" args="$(arg groundtruth_bag)"/>

    <!-- Start the two new visualizer nodes -->
    <node pkg="imu_algorithm_visualization" type="ground_truth_visualizer_node" name="ground_truth_visualizer_node" output="screen"/>
    <node pkg="imu_algorithm_visualization" type="gravity_measurement_visualizer_node" name="gravity_measurement_visualizer_node" output="screen"/>

    <!-- Start RViz with a pre-configured file -->
    <node type="rviz" name="rviz" pkg="rviz" args="-d $(find imu_algorithm_visualization)/gravity_analyze.rviz" />

</launch>
